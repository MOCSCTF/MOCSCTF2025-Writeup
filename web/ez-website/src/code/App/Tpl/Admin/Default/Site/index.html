<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta name="version" content="1.2">
	<include file="Public:meta" />
</head>
<body id="main_page">
<include file="Public:position" />
<div class="container">
      <form enctype="multipart/form-data" method="post" id="frm">
            <div class="table">
               <div class="toolbars">
                    <li class="toolbar"><a id="selectall" onclick="CheckAll()"  title="全选" style="display: none;">全选</a></li>
                    <li class="toolbar"><a id="btnSaveAll" onclick="add()"  title="添加新的分站" target="_self">添加新的分站</a></li>
                    <li class="toolbar"><a id="btnSave" onclick="saveAll()"  title="保存所有修改" target="_self">保存所有修改</a></li>
                    <li class="toolbar" style="display: none;"><a id="btnSave" onclick="makePinyin()" class="ydicon-shengcheng" title="生成分站英文名" target="_self">生成分站域名</a></li>
                    <li class="toolbar"><a id="del" onclick="batchDel()" title="批量删除">删除</a></li>

                   <li class="toolbar toolbarform">
                       <label>关键词</label><input type="text" class='textinput' name="Keywords" style="width:260px" value="{$Keywords}" id="Keywords" placeholder="按名称/域名/页面标题检索"/>

                       <a id="btnSeek" class="btnToolbarForm" onclick="Search()">查询</a>
                   </li>
              </div>
                <table class="datatable" id="datatable">
                    <tr>
                     	<th width="45px" nowrap="nowrap" onclick="CheckAll()"><input type="checkbox" /></th>
                         <th width="55px" >编号</th>
                         <th width="80px" >分站名称</th>
                         <th width="220px"  >分站域名</th>
                         <th width="90px" >排序</th>
                         <th  width="" >页面标题Title</th>
                         <th width="" >页面关键词Keywords</th>
                         <th >页面描述Description</th>
                         <th width="80px" >是否启用</th>
                         <th width="80px" >操作</th>
                    </tr>  
                    <notempty name="Data">
                        <volist name="Data" id="d">
                            <tr id="row{$d.SiteID}" name="{$d.SiteName|htmlspecialchars}">
                                <td><input class="checkrow" type="checkbox" name="id[]" value="{$d.SiteID}" /></td>
                                <td>{$d.SiteID}</td>
                                <td><input type="text" class='textinput IsEnable{$d.IsEnable}' value="{$d.SiteName|htmlspecialchars}" style="width:97%" name="SiteName[]" /></td>
                                <td><input type="text" class='textinput IsEnable{$d.IsEnable}' value="{$d.SiteDomain|htmlspecialchars}" style="width:97%" name="SiteDomain[]" /></td>
                                <td>
                                    <input type="number" class='textinput IsEnable{$d.IsEnable}' onclick="this.select()" style="width:70px" name="SiteOrder[]" value="{$d.SiteOrder}" />
                                    <input type="hidden" class='textinput' name="SiteID[]" value="{$d.SiteID}" />                                </td>
                                <td><input type="text" class='textinput IsEnable{$d.IsEnable}' value="{$d.SiteTitle|htmlspecialchars}" style="width:97%" name="SiteTitle[]" /></td>
                                <td><input type="text" class='textinput IsEnable{$d.IsEnable}' value="{$d.SiteKeywords|htmlspecialchars}" style="width:97%" name="SiteKeywords[]" /></td>
                                <td><textarea  class='textinput IsEnable{$d.IsEnable}' style="width:97%" name="SiteDescription[]">{$d.SiteDescription|htmlspecialchars}</textarea></td>
                                <td>
                                    <eq name="d.IsEnable" value="1">
                                        <span  style="cursor:pointer;color:black;" onclick="toggleStatus(this,{$d.SiteID},'site')">启用</span>
                                    <else/>
                                        <span  style="cursor:pointer;color:red;"  onclick="toggleStatus(this,{$d.SiteID},'site')">禁用</span>                                    
									</eq>                                
								</td>
                                <td  class="operator">
                                  <!--  <a onclick="Edit({$d.SiteID})" id="btnEdit">修改</a>-->
                                            <div class="btn-sep"></div>
                                    <a onclick="del({$d.SiteID})" class="btnDel">删除</a>  
								</td>
                            </tr>
                        </volist>
                    <else/>
                        <tr><td colspan="9" id="NoData">{$Think.lang.NoDataTip}</td></tr>
                    </notempty>
                </table>
                 <div class="tfoot">
                     <div class="page">
                         <span class="pagesize">每页<span class="pz">{$AdminPageSize}</span>条</span>{$Page}
                        &nbsp;&nbsp;&nbsp;&nbsp;<select id="PageSize" name="PageSize" onchange="Search()" style="color: #666;" >
                         <option value="10" >10条/页</option>
                         <option value="20">20条/页</option>
                         <option value="50">50条/页</option>
                         <option value="100">100条/页</option>
                     </select>
                     </div>
                      <div id="notice">
                            <b>说明：</b>
                            <span class="notice-item">如果分站域名为空，系统将自动获取中文分站名称的拼音加上主站域名</span>
                      </div>
                 </div>
            </div>
        </form>
</div>
</body>
</html>
<div class="dialog" id="dlgAdd" title="添加新的分站名称">
    <table class="boxtable">
        <tr><td> <a id="btnSaveAll" class="addAreaList" onclick='addAreaList()'  >+ 快速添加分站名称</a></td></tr>
        <tr>
            <td valign="middle">
            	<textarea style="width:190px;height:200px" name="dlgSiteName" id="dlgSiteName" placeholder="北京&#13;&#10;上海&#13;&#10;广州"></textarea>
            </td>
        </tr>
        <tr><td style="color:red;">多个分站名称以回车分开</td></tr>

    </table>
</div>
<script type="text/javascript">
    var gDlg = '';
    var content = '<div id="dlgArea"><iframe src="{$Url}area" name="frmArea" id="frmArea"  scrolling="yes" frameborder="0"  height="490px" width="500px;"></iframe></div>';
    function addAreaList(){
        gDlg = dialog({
            title: '请选择地区',
            id: 'Area',
            padding: 0,
            content: content,
            ok: function () {
                var obj = window.frames['frmArea'].document;
                var objSelected = $(obj).find('.checkrow:checked');
                var str = '';
                var n = objSelected.length;
                if(n > 0){
                    for(var i=0; i < n; i++){
                        var sitename = objSelected.eq(i).attr('data_name');
                        str += sitename + "\r\n";
                    }
                }else{
                    str = '';
                }

                $('#dlgSiteName').val(str);
                this.close();
                return false;
            },
            cancel:function(){
                this.close();
            },
            okValue: '添加并继续',
            cancelValue: '关闭',
            cancel: true
        }).show();
    }

function saveAll(){
	if(checkSafeQuestion()) return;
	ConfirmBox("确定要保存所有修改吗？", function () {
		$('#frm').attr("action", "__URL__/saveAll?p={$Think.request.p}");
		$('#frm').submit();
	});
}

function del(id){
	var key = $("#row"+id).attr("name");
	var tip = DeleteTip(key);
	ConfirmBox(tip, function () {
		LoadBox();
		var url = "{$Url}del/id/"+id;
		$.get(url, null, function(data){
			CloseLoadBox();
			if(data.status==1){
				$("#row"+id).remove();
			}else{
				ErrorBox( data.info );
			}
		}, "json");
	});
}

function makePinyin(){
	ConfirmBox("确定生成所有分站域名吗？如果域名存在则不生成", function () {
		LoadBox();
		var url = "{$Url}makePinyin";
		$.get(url, null, function(data){
			CloseLoadBox();
			location.href="{$Url}index";
		}, "json");
	});
}

function batchDel(){
	if(checkSafeQuestion()) return;
	var arrChk = $("input[name='id[]']");
	var n = 0;
	for(var i = 0; i < arrChk.length; i++){
		if(arrChk[i].checked) n++;
	}

	if( n == 0 ) {
		WarnBox("{$Think.lang.CheckDeleteTip}");
		return;
	}

	ConfirmBox("{$Think.lang.DeleteTip}", function () {
		$('#frm').attr("action", "__URL__/batchDel?p={$Think.request.p}");
		$('#frm').submit();
	});
}

function add(){
	$("#dlgSiteName").val('');
	dialog({
			title: $('#dlgAdd').attr('title'),
			id: 'add',
			padding: 8,
			content: document.getElementById('dlgAdd'),
			ok: function () {
				var SiteName = $("#dlgSiteName").val();
				if(!SiteName){
					ErrorBox("分站名称不能为空！");
					return false;
				}
				LoadBox();
				var url = "{$Url}add";
				var params = {
					Parent: "{$SiteID}",
					SiteName: SiteName,
				};
				$.post(url, params, function(data){
					CloseLoadBox();
					if(data.status==1){
						location.href = "{$Url}index/id/{$SiteID}";
					}else{
                        ErrorBox(data.info);
                    }
				}, "json");
				return false;
			},
			okValue: '确定',
			cancelValue: '关闭',
			cancel: true
		}).show();
}

function Search(){
    $('#frm').attr("action", "{$Url}index");
    $('#frm').submit();
    return true;
}

    $(document).ready(function(){
        $("#PageSize").val("{$AdminPageSize}");
    });
</script>